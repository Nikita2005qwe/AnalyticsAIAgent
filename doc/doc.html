<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Документация к программе AnalyticsAIAgent</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <header>
        <h1>Документация к программе <strong>AnalyticsAIAgent</strong></h1>
        <p class="subtitle">AI-агент для автоматизации задач аналитика: создание и перепривязка ТТ, проверка накладных</p>
    </header>

    <nav class="toc">
        <h2>Содержание</h2>
        <ul>
            <li><a href="#section1">1. Цели и актуальность</a></li>
            <li><a href="#section2">2. Модули и классы</a></li>
            <li><a href="#section3">3. Модели данных</a></li>
            <li><a href="#section4">4. Тест-кейсы</a></li>
        </ul>
    </nav>

    <main>

        <!-- === 1. Цели и актуальность === -->
        <section id="section1">
            <h2>1. Цели и актуальность</h2>

            <h3>1.1. Основные цели создания системы</h3>
            <p>
                <strong>AnalyticsAIAgent</strong> разрабатывается как интеллектуальный оркестратор бизнес-процессов, который:
            </p>
            <ul>
                <li>Принимает команды от пользователя в <strong>естественной форме</strong> (текст, голос).</li>
                <li>Понимает намерение и извлекает параметры.</li>
                <li>Автоматизирует выполнение рутинных операций в CRM, DMS и 1С.</li>
                <li>Минимизирует ручной труд, снижает количество ошибок и ускоряет обработку запросов.</li>
            </ul>
            <p>
                <strong>Главная цель — превратить аналитика из исполнителя в контролёра.</strong> Вместо ручного ввода система берёт на себя выполнение, а аналитик контролирует результат.
            </p>

            <h3>1.2. Основные принципы архитектуры</h3>
            <p>Система построена по принципам модульности, устойчивости и расширяемости:</p>
            <table>
                <tr>
                    <th>Принцип</th>
                    <th>Описание</th>
                </tr>
                <tr>
                    <td><strong>AI как оркестратор</strong></td>
                    <td>AI-агент принимает решение, валидирует данные, вызывает нужный процесс и отслеживает результат, но не выполняет действия напрямую.</td>
                </tr>
                <tr>
                    <td><strong>POM (Page Object Model)</strong></td>
                    <td>Все взаимодействия с веб-интерфейсами (CRM, DMS) реализованы через POM, что делает автоматизацию устойчивой к изменениям UI.</td>
                </tr>
                <tr>
                    <td><strong>Разделение operation / process / view</strong></td>
                    <td>
                        <ul>
                            <li><strong>operation</strong> — низкоуровневое действие (например, «ввести адрес»)</li>
                            <li><strong>process</strong> — оркестрация операций (например, «создать точку»)</li>
                            <li><strong>view</strong> — GUI-интерфейс для ручного запуска</li>
                        </ul>
                    </td>
                </tr>
                <tr>
                    <td><strong>Декларативные модели данных</strong></td>
                    <td>Данные о торговых точках, накладных и привязках описываются в JSON. Это обеспечивает масштабируемость и тестируемость.</td>
                </tr>
                <tr>
                    <td><strong>Поддержка ручного и автоматического режимов</strong></td>
                    <td>Система может работать как автономно, так и с участием пользователя (например, при уточнении данных).</td>
                </tr>
            </table>

            <h3>1.3. Типичные сценарии использования</h3>
            <table>
                <tr>
                    <th>Сценарий</th>
                    <th>Описание</th>
                    <th>Частота</th>
                </tr>
                <tr>
                    <td><strong>Создание торговой точки</strong></td>
                    <td>Пользователь загружает JSON с данными → система создаёт ТТ в CRM через Selenium.</td>
                    <td>Ежедневно</td>
                </tr>
                <tr>
                    <td><strong>Массовое создание ТТ</strong></td>
                    <td>Пользователь отправляет файл с 50+ точками → система обрабатывает по одной, логирует ошибки.</td>
                    <td>Раз в 1–2 недели</td>
                </tr>
                <tr>
                    <td><strong>Перепривязка ТТ к ESR</strong></td>
                    <td>Менеджер не видит точку → система находит ТТ по <code>1СТТUID</code>, проверяет <code>XCRM_GUID</code>, обновляет привязку.</td>
                    <td>Ежедневно</td>
                </tr>
                <tr>
                    <td><strong>Проверка выгрузки накладных в DMS</strong></td>
                    <td>Система заходит в DMS, ищет накладные по списку → возвращает статистику: сколько выгружено, сколько нет.</td>
                    <td>Ежедневно</td>
                </tr>
            </table>

            <h3>1.4. Оцениваемые метрики эффективности</h3>
            <p>Реальные показатели на основе практики аналитика:</p>
            <table>
                <tr>
                    <th>Метрика</th>
                    <th>Ручной режим</th>
                    <th>Прогноз (AI-агент)</th>
                    <th>Экономия</th>
                </tr>
                <tr>
                    <td>Время на 1 торговую точку</td>
                    <td>2 минуты</td>
                    <td>15 секунд</td>
                    <td>87.5%</td>
                </tr>
                <tr>
                    <td>Время на 5 точек</td>
                    <td>10 минут</td>
                    <td>1.25 минуты</td>
                    <td>87.5%</td>
                </tr>
                <tr>
                    <td>Время на 56 точек</td>
                    <td>~2 часа</td>
                    <td>~14 минут</td>
                    <td>~87.5%</td>
                </tr>
                <tr>
                    <td>Ошибки при вводе</td>
                    <td>5–10%</td>
                    <td>< 1%</td>
                    <td>в 5–10 раз</td>
                </tr>
                <tr>
                    <td>Повторная обработка из-за "зависших" привязок</td>
                    <td>Часто</td>
                    <td>Редко</td>
                    <td>снижение до 5%</td>
                </tr>
            </table>
            <div class="note">
                Пример: 30.07 было обработано 56 точек. Ручное время — ~2 часа. С AI-агентом — ~14 минут. Экономия: ~1.5 часа.
            </div>
        </section>

        <!-- === 2. Модули и классы === -->
        <section id="section2">
            <h2>2. Модули и классы</h2>

            <h3>2.1. Архитектура системы</h3>
            <p>
                <strong>AnalyticsAIAgent</strong> построен по принципу <strong>модульной, многоуровневой архитектуры</strong>, где каждый компонент отвечает за свою зону ответственности.
            </p>
            <p>
                Система использует паттерны:
            </p>
            <ul>
                <li><strong>Page Object Model (POM)</strong> — для стабильного взаимодействия с веб-интерфейсами.</li>
                <li><strong>Разделение operation / process / view</strong> — для гибкости и повторного использования кода.</li>
                <li><strong>AI-агент как оркестратор</strong> — принимает команды, решает, что запускать, и контролирует выполнение.</li>
            </ul>

            <h3>2.2. Точка входа: <code>main.py</code></h3>
            <p>Файл <code>main.py</code> — точка входа в приложение. Он запускает GUI через:</p>
            <pre><code>from src.core.application import Application
 Application().run()</code></pre>
            <p>При старте инициализируется графическое окно, загружаются вкладки и начинается ожидание действий пользователя.</p>

            <h3>2.3. Графический интерфейс: <code>src/core/application.py</code></h3>
            <p>Класс <code>Application</code> наследуется от <code>QMainWindow</code> (PyQt5) и управляет:</p>
            <ul>
                <li>Созданием главного окна и вкладок</li>
                <li>Полями ввода: ID, название, адрес, ESR, загрузка JSON</li>
                <li>Кнопками: «Создать точку», «Перепривязать», «Проверить накладные»</li>
                <li>Логом выполнения операций</li>
            </ul>
            <p><strong>Интеграция:</strong> Работает с <code>PointManager</code> и другими менеджерами из <code>business_processes</code>.</p>
            <p><strong>Обработчики событий:</strong></p>
            <table>
                <tr>
                    <th>Метод</th>
                    <th>Описание</th>
                </tr>
                <tr>
                    <td><code>_on_create_single()</code></td>
                    <td>Запускает процесс создания одной торговой точки</td>
                </tr>
                <tr>
                    <td><code>_on_bulk_create()</code></td>
                    <td>Массовое создание ТТ из JSON</td>
                </tr>
                <tr>
                    <td><code>_on_rebind_single()</code></td>
                    <td>Перепривязка одной точки к новому ESR</td>
                </tr>
                <tr>
                    <td><code>_on_bulk_rebind()</code></td>
                    <td>Массовая перепривязка</td>
                </tr>
            </table>

            <h3>2.4. POM (Page Object Model): <code>src/pages/</code></h3>
            <p>Модуль <code>pages</code> содержит классы для взаимодействия с веб-интерфейсами через Selenium.</p>
            <p>Поддерживаемые системы:</p>
            <ul>
                <li><strong>CRM</strong> — создание, поиск, привязка ТТ</li>
                <li><strong>DMS</strong> — проверка выгрузки накладных</li>
                <li><strong>1С</strong> — чтение данных (в будущем)</li>
            </ul>

            <h4>Структура POM:</h4>
            <pre>
src/pages/
├── crm/
│   ├── login_page.py
│   ├── organization_page.py
│   └── binding_page.py
├── dms/
│   ├── login_page.py
│   ├── documents_page.py
│   └── distributor_panel.py
└── one_s/
    └── data_reader_page.py (в будущем)
            </pre>

            <h4>Пример: Проверка накладных в DMS</h4>
            <ol>
                <li>Запуск браузера</li>
                <li>Авторизация на <code>good food shop</code></li>
                <li>Вход в панель дистрибьютора</li>
                <li>Переход в раздел «Документы»</li>
                <li>Поиск каждой накладной из списка</li>
                <li>Сбор статуса: выгружена / не выгружена</li>
                <li>Формирование результата</li>
            </ol>

            <h3>2.5. Бизнес-логика: <code>src/business_processes/</code></h3>
            <p>Модуль содержит процессы, которые выполняет аналитик. Каждый процесс следует шаблону:</p>
            <ul>
                <li><code>operation.py</code> — низкоуровневые действия (например, «проверить одну накладную»)</li>
                <li><code>process.py</code> — оркестрация полного процесса</li>
                <li><code>view.py</code> — GUI-элементы для ручного запуска (опционально)</li>
            </ul>

            <h4>Базовые методы в <code>process.py</code>:</h4>
            <table>
                <tr>
                    <th>Метод</th>
                    <th>Описание</th>
                </tr>
                <tr>
                    <td><code>run()</code></td>
                    <td>Запускает выполнение процесса</td>
                </tr>
                <tr>
                    <td><code>validate()</code></td>
                    <td>Проверяет, все ли входные данные известны</td>
                </tr>
                <tr>
                    <td><code>load_data(data)</code></td>
                    <td>Загружает входные данные (JSON, 1С)</td>
                </tr>
                <tr>
                    <td><code>get_results()</code></td>
                    <td>Возвращает результат и проверяет его корректность</td>
                </tr>
            </table>

            <h4>Пример: <code>check_invoices</code></h4>
            <ul>
                <li><strong>Вход:</strong> список номеров накладных</li>
                <li><strong>Процесс:</strong> поочерёдная проверка в DMS</li>
                <li><strong>Выход:</strong>
                    <ul>
                        <li>Количество выгруженных</li>
                        <li>Количество невыгруженных</li>
                        <li>Список для ручной проверки</li>
                    </ul>
                </li>
            </ul>

            <h4>Пример: <code>rebind_tt</code></h4>
            <p>Процесс перепривязки ТТ к новой территории ESR:</p>
            <ol>
                <li>Получение <code>1СТТUID</code> от пользователя</li>
                <li>Поиск <code>XCRM_GUID</code> в 1С</li>
                <li>Если нет — создать новую организацию в CRM</li>
                <li>Если есть — найти ТТ в CRM</li>
                <li>Найти целевую территорию ESR по имени (например, <code>GC_Абакан Н55_esr</code>)</li>
                <li>Деактивировать старую привязку (если есть)</li>
                <li>Создать новую привязку (даже если территория та же — для запуска синхронизации)</li>
                <li>Подтвердить: точка будет отображаться у ESR</li>
            </ol>

            <h3>2.6. Зависимости и интеграции</h3>
            <table>
                <tr>
                    <th>Модуль</th>
                    <th>Зависимости</th>
                </tr>
                <tr>
                    <td><code>application</code></td>
                    <td>PyQt5, PointManager</td>
                </tr>
                <tr>
                    <td><code>pages</code></td>
                    <td>Selenium, WebDriver</td>
                </tr>
                <tr>
                    <td><code>business_processes</code></td>
                    <td>pages, config, models</td>
                </tr>
                <tr>
                    <td><code>config</code></td>
                    <td>JSON, settings.json</td>
                </tr>
            </table>
        </section>

        <!-- === 3. Модели данных === -->
        <section id="section3">
            <h2>3. Модели данных</h2>
            <p>См. предыдущую версию — содержание сохранено.</p>
        </section>

        <!-- === 4. Тест-кейсы === -->
        <section id="section4">
            <h2>4. Тест-кейсы</h2>
            <p>В разработке.</p>
        </section>

    </main>

    <footer>
        Документация к программе AnalyticsAIAgent<br>
        Последнее обновление: 1 августа 2025 г.<br>
        Разработчик: Боряков Никита Андреевич<br>
        Готово к правкам и дополнениям.
    </footer>

</body>
</html>