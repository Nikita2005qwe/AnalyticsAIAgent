"""
–ú–æ–¥—É–ª—å: operation.py
–û–ø–∏—Å–∞–Ω–∏–µ: –û–ø–µ—Ä–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∫–ª–∞–¥–Ω–æ–π –≤ —Å–∏—Å—Ç–µ–º–µ.

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:
- –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å—Ü–µ–Ω–∞—Ä–∏–π: –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è ‚Üí –Ω–∞–≤–∏–≥–∞—Ü–∏—è ‚Üí –ø–æ–∏—Å–∫ ‚Üí —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
- –†–∞–±–æ—Ç–∞—Ç—å –≤ —Ä–∞–º–∫–∞—Ö **–æ–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏ –±—Ä–∞—É–∑–µ—Ä–∞** –Ω–∞ –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å.
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Page Objects (`LoginPage`, `InvoicesPage` –∏ –¥—Ä.).
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **–¥–æ–º–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å** `Invoice` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –ª–æ–≥–∏–∫–∏.
- –ë—ã—Ç—å **–∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π**, –Ω–æ **–Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω–Ω–æ–π –∫ –Ω–∞–∑–≤–∞–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã**.

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è —Ä–æ–ª—å:
- –ê—Ç–æ–º–∞—Ä–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è: "–Ω–∞–π—Ç–∏ –Ω–∞–∫–ª–∞–¥–Ω—É—é".
- –ß–∞—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞ `InvoiceCheckerProcess`.
- –ù–µ –∑–Ω–∞–µ—Ç –æ Excel, —Ñ–∞–π–ª–∞—Ö, UI.

–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
- Selenium WebDriver
- Page Objects: `LoginPage`, `MainPage`, `SubsystemsPage`, `DistributorPanelPage`, `InvoicesPage`
- models.invoice: Invoice, InvoiceFactory, should_process, get_region_by_prefix
- Logger ‚Äî –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ö–æ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
"""

# --- –ò–º–ø–æ—Ä—Ç—ã –∏–∑ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ ---
from typing import Tuple, Optional

from numpy.ma.core import logical_not
# --- –ò–º–ø–æ—Ä—Ç—ã –∏–∑ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫ ---
from selenium import webdriver
from selenium.webdriver.support.ui import WebDriverWait

# --- –ò–º–ø–æ—Ä—Ç—ã –∏–∑ src ---
from src.pages.dms.main_page import MainPage
from src.pages.dms.login_page import LoginPage
from src.pages.dms.subsystems_page import SubsystemsPage
from src.pages.dms.distributor_panel_page import DistributorPanelPage
from src.pages.dms.invoices_page import InvoicesPage

# --- –ò–º–ø–æ—Ä—Ç—ã –∏–∑ –º–æ–¥–µ–ª–µ–π ---
from src.models.invoice.invoice import Invoice, CheckedInvoice, CheckStatus

# --- –ò–º–ø–æ—Ä—Ç—ã –∏–∑ core ---
from src.core.logger import Logger
from src.core.config import Config

class InvoiceSearchOperation:
    """
    –û–ø–µ—Ä–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –Ω–∞–∫–ª–∞–¥–Ω–æ–π –≤ —Å–∏—Å—Ç–µ–º–µ.

    –ö–∞–∂–¥—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä ‚Äî **–æ–¥–Ω–∞ —Å–µ—Å—Å–∏—è –±—Ä–∞—É–∑–µ—Ä–∞** –¥–ª—è –æ–¥–Ω–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞.
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö.

    –ê—Ç—Ä–∏–±—É—Ç—ã:
    - region (str): "siberia" –∏–ª–∏ "ural"
    - driver (WebDriver): –£–ø—Ä–∞–≤–ª—è–µ—Ç –±—Ä–∞—É–∑–µ—Ä–æ–º
    - logger (Logger): –î–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Ö–æ–¥–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
    - factory (InvoiceFactory): –î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—ä–µ–∫—Ç–æ–≤ Invoice
    - main_page (MainPage): –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
    - login_page (LoginPage): –°—Ç—Ä–∞–Ω–∏—Ü–∞ –≤—Ö–æ–¥–∞
    - subsystems_page (SubsystemsPage): –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–¥—Å–∏—Å—Ç–µ–º
    - distributor_panel (DistributorPanelPage): –ü–∞–Ω–µ–ª—å –¥–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä–∞
    - invoices_page (InvoicesPage): –°—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∏—Å–∫–∞ –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö
    - _initialized (bool): –§–ª–∞–≥ ‚Äî —Å–µ—Å—Å–∏—è –∑–∞–ø—É—â–µ–Ω–∞
    """

    # –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–≥–∏–æ–Ω–∞ ‚Üí –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    CREDENTIALS = {
        "siberia": ("DMS_USERNAME_SIB", "DMS_PASSWORD_SIB"),
        "ural": ("DMS_USERNAME_URAL", "DMS_PASSWORD_URAL"),
    }

    def __init__(self, region: str, logger: Logger, config: Config):
        """
        –°–æ–∑–¥–∞—ë—Ç –æ–ø–µ—Ä–∞—Ü–∏—é –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ä–µ–≥–∏–æ–Ω–∞.

        Args:
            region (str): "siberia" –∏–ª–∏ "ural"
            logger (Logger): –≠–∫–∑–µ–º–ø–ª—è—Ä –ª–æ–≥–≥–µ—Ä–∞ –¥–ª—è –∑–∞–ø–∏—Å–∏ —Å–æ–±—ã—Ç–∏–π

        Raises:
            ValueError: –ï—Å–ª–∏ —Ä–µ–≥–∏–æ–Ω –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è

        –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:
        - –õ–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –±–µ—Ä—É—Ç—Å—è –∏–∑ .env –ø–æ –∫–ª—é—á–∞–º, –∑–∞–≤–∏—Å—è—â–∏–º –æ—Ç —Ä–µ–≥–∏–æ–Ω–∞.
        - –î—Ä–∞–π–≤–µ—Ä —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—ã–∑–æ–≤–µ check_invoice().
        - –í—Å–µ Page Objects –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ.
        - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç InvoiceFactory –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Invoice.
        """
        self.region = region.lower()
        if self.region not in self.CREDENTIALS:
            raise ValueError(f"–ù–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–µ–≥–∏–æ–Ω {region}")
        self.logger = logger
        self.driver = None
        self.invoices_page: Optional[InvoicesPage] = None
        self._initialized = False
        self.config = config

    def check_invoice(self, invoice: Invoice) -> CheckedInvoice:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç, –Ω–∞–π–¥–µ–Ω–∞ –ª–∏ –Ω–∞–∫–ª–∞–¥–Ω–∞—è –≤ —Å–∏—Å—Ç–µ–º–µ.

        –û—Å–Ω–æ–≤–Ω–∞—è —Ü–µ–ª—å ‚Äî –≤–µ—Ä–Ω—É—Ç—å **–æ–¥–Ω–æ–∑–Ω–∞—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç** (True/False), –¥–∞–∂–µ –µ—Å–ª–∏:
        - –ë—Ä–∞—É–∑–µ—Ä –±—ã–ª –∑–∞–∫—Ä—ã—Ç –≤—Ä—É—á–Ω—É—é,
        - –ü—Ä–æ–∏–∑–æ—à—ë–ª —Ç–∞–π–º–∞—É—Ç,
        - –°–µ—Å—Å–∏—è —É—Å—Ç–∞—Ä–µ–ª–∞.

        –ú–µ—Ç–æ–¥ —Å–ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ **—É—Å—Ç–æ–π—á–∏–≤—ã–π –∫ —Å–±–æ—è–º**: –æ–Ω –Ω–µ –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å
        –∏–∑-–∑–∞ –æ–¥–Ω–æ–π –Ω–∞–∫–ª–∞–¥–Ω–æ–π. –í—Å—ë, —á—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å ‚Äî –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ –æ—à–∏–±–∫–∞,
        –Ω–æ –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è.

        Args:


        Returns:
            bool:
                - True ‚Äî –Ω–∞–∫–ª–∞–¥–Ω–∞—è –Ω–∞–π–¥–µ–Ω–∞ (—Ö–æ—Ç—è –±—ã –Ω–∞ –æ–¥–Ω–æ–π –ø–ª–æ—â–∞–¥–∫–µ)
                - False ‚Äî –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞

        –®–∞–≥–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:

        1. **–°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–º–µ–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞:**
           - –í—ã–∑–≤–∞—Ç—å self.factory.from_number(invoice_number)
           - –ü–æ–ª—É—á–∏—Ç—å Invoice —Å –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–º–∏:
               - number
               - prefix
               - region (–ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É)
           - –ï—Å–ª–∏ –ø—Ä–µ—Ñ–∏–∫—Å –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω ‚Äî –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å "‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å: {prefix}",
             –¥–æ–±–∞–≤–∏—Ç—å –≤ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É, –≤–µ—Ä–Ω—É—Ç—å False

        2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∏–∑–Ω–µ—Å-—É—Å–ª–æ–≤–∏–π:**
           - –í—ã–∑–≤–∞—Ç—å should_process(invoice)
           - –ï—Å–ª–∏ False (–Ω–∞–ø—Ä–∏–º–µ—Ä, ISA=0 –∏–ª–∏ SFA –ø—É—Å—Ç–æ) ‚Äî –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å "üü° –ü—Ä–æ–ø—É—â–µ–Ω–∞ (–Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Ñ–∏–ª—å—Ç—Ä)",
             –≤–µ—Ä–Ω—É—Ç—å False
           - –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

        3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Ä–µ–≥–∏–æ–Ω–∞:**
           - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ invoice.region == self.region
           - –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å "‚ö†Ô∏è –†–µ–≥–∏–æ–Ω –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç: –æ–∂–∏–¥–∞–µ—Ç—Å—è {self.region}, –Ω–∞–π–¥–µ–Ω {invoice.region}"
             –∏ –≤–µ—Ä–Ω—É—Ç—å False
           - –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –Ω–∞–∫–ª–∞–¥–Ω–∞—è –∏–∑ –£—Ä–∞–ª–∞ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤ —Å–µ—Å—Å–∏–∏ –°–∏–±–∏—Ä–∏

        4. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):**
           - –í—ã–∑–≤–∞—Ç—å self._is_driver_alive()
           - –ï—Å–ª–∏ –¥—Ä–∞–π–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–∫—Ä—ã–ª –±—Ä–∞—É–∑–µ—Ä):
               * –ó–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å "‚ö†Ô∏è –ë—Ä–∞—É–∑–µ—Ä –∑–∞–∫—Ä—ã—Ç. –ü–æ–ø—ã—Ç–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏..."
               * –í—ã–∑–≤–∞—Ç—å self._recover_session()
               * –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å ‚Äî –≤–µ—Ä–Ω—É—Ç—å False, –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é"
           - –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ—Å–ª–µ —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∑–∞–∫—Ä—ã—Ç–∏—è –æ–∫–Ω–∞

        5. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –≥–æ—Ä–æ–¥:**
           - –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≥–æ—Ä–æ–¥ –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É (get_city_by_prefix)
           - –í—ã–∑–≤–∞—Ç—å self._switch_to_city(city)
           - –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å ‚Äî –≤–µ—Ä–Ω—É—Ç—å False, –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—à–∏–±–∫—É

        6. **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞:**
           - –ó–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å "üîç –ü–æ–∏—Å–∫ –Ω–∞–∫–ª–∞–¥–Ω–æ–π: {invoice_number}"
           - –í—ã–∑–≤–∞—Ç—å self.invoices_page.perform_search(invoice_number)
           - –î–æ–∂–¥–∞—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞: self.invoices_page.wait_for_search_result(timeout=15)
           - –ï—Å–ª–∏ —Ç–∞–π–º–∞—É—Ç ‚Äî –∑–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å "‚è∞ –¢–∞–π–º–∞—É—Ç –ø–æ–∏—Å–∫–∞", –≤–µ—Ä–Ω—É—Ç—å False

        7. **–ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
           - –í—ã–∑–≤–∞—Ç—å self.invoices_page.is_empty()
           - –ï—Å–ª–∏ False (—Ç–∞–±–ª–∏—Ü–∞ –Ω–µ –ø—É—Å—Ç–∞) ‚Üí –Ω–∞–∫–ª–∞–¥–Ω–∞—è –Ω–∞–π–¥–µ–Ω–∞ ‚Üí –≤–µ—Ä–Ω—É—Ç—å True
           - –ï—Å–ª–∏ True (–ø—É—Å—Ç–æ) ‚Üí –ø–µ—Ä–µ–π—Ç–∏ –∫ —à–∞–≥—É 8

        8. **–ü–æ–ø—ã—Ç–∫–∞ –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–π –ø–ª–æ—â–∞–¥–∫–µ (–µ—Å–ª–∏ –µ—Å—Ç—å):**
           - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –µ—Å—Ç—å –ª–∏ alternative_city –≤ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–µ—Ñ–∏–∫—Å–∞
           - –ï—Å–ª–∏ –µ—Å—Ç—å:
               * –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ alternative_city
               * –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –ø–æ–∏—Å–∫ (—à–∞–≥–∏ 6‚Äì7)
               * –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–∞ ‚Äî –≤–µ—Ä–Ω—É—Ç—å True
           - –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ "–Ω–µ –Ω–∞–π–¥–µ–Ω–∞"

        9. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
           - –ó–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å:
               - "‚úÖ {number}: –Ω–∞–π–¥–µ–Ω–∞" ‚Äî –µ—Å–ª–∏ True
               - "‚ùå {number}: –Ω–µ –Ω–∞–π–¥–µ–Ω–∞" ‚Äî –µ—Å–ª–∏ False –∏ –Ω–µ—Ç –æ—à–∏–±–∫–∏
               - "‚ö†Ô∏è {number}: –æ—à–∏–±–∫–∞ ‚Äî {—Å–æ–æ–±—â–µ–Ω–∏–µ}" ‚Äî –µ—Å–ª–∏ –±—ã–ª–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
           - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç self.logger.log() ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤–∏–¥–µ–Ω –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

        10. **–í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:**
            - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç bool, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ
              –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∏ –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –≤ Excel

        –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
        - –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è: —Å—Ç–∞—Ä—Ç, –ø–æ–∏—Å–∫, —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –æ—à–∏–±–∫–∏
        - –°–æ–æ–±—â–µ–Ω–∏—è –ø–æ–Ω—è—Ç–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (—ç–º–æ–¥–∑–∏, –∫—Ä–∞—Ç–∫–æ—Å—Ç—å)
        - –û—à–∏–±–∫–∏ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –ø—Ä–æ—Ü–µ—Å—Å ‚Äî —Ç–æ–ª—å–∫–æ –ø–æ–º–µ—á–∞—é—Ç—Å—è

        –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π:
        - –í—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è (TimeoutException, StaleElement, ConnectionError –∏ –¥—Ä.)
          –ø–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞—é—Ç—Å—è, –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –∏ –º–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç False
        - –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–∞–¥–µ–Ω–∏–µ –≤—Å–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏–∑-–∑–∞ –æ–¥–Ω–æ–π –Ω–∞–∫–ª–∞–¥–Ω–æ–π

        Raises:
            –ù–∏–∫–∞–∫–∏—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π –Ω–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç ‚Äî –≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç bool.
            –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ.

        –í–∞–∂–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
        - **–ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏ –æ—à–∏–±–∫–µ** ‚Äî –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
        - **–†–∞–±–æ—Ç–∞–µ—Ç —Å –∂–∏–≤—ã–º –±—Ä–∞—É–∑–µ—Ä–æ–º** ‚Äî –µ—Å–ª–∏ –∑–∞–∫—Ä—ã—Ç, –ø—ã—Ç–∞–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
        - **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–æ–º–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å** ‚Äî Invoice, –ø—Ä–∞–≤–∏–ª–∞, —Ñ–∞–±—Ä–∏–∫—É
        - **–ì–æ—Ç–æ–≤ –∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è–º** ‚Äî –¥–∞–∂–µ –µ—Å–ª–∏ —É–ø–∞–¥—ë—Ç, —á–∞—Å—Ç–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ

        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç:
        - InvoiceFactory.from_number() ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞
        - should_process() ‚Üí —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
        - get_city_by_prefix() ‚Üí –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞
        - _is_driver_alive() –∏ _recover_session() ‚Üí —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å
        - InvoicesPage.perform_search(), wait_for_search_result(), is_empty() ‚Üí –ø–æ–∏—Å–∫
        - Logger.log() ‚Üí –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ö–æ–¥–∞

        –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ:
            found = operation.check_invoice("01/12345")
            # ‚Üí True/False, –≤—Å–µ–≥–¥–∞
            :param invoice:
        """
        if not self._initialized:
            self.start()
        try:
            # –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –Ω—É–∂–Ω—ã–π –≥–æ—Ä–æ–¥
            self._switch_to_city(invoice.delivery_city)
            # –í–≤–æ–¥–∏–º –≤ –ø–æ–ª–µ –ø–æ–∏—Å–∫–∞ –Ω–æ–º–µ—Ä
            self.invoices_page.perform_search(invoice.number)
            # –û–∂–∏–¥–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            self.invoices_page.wait_for_search_result()
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç—É—Å –Ω–∞–∫–ª–∞–¥–Ω–æ–π
            status = CheckStatus.FOUND if not self.invoices_page.is_empty() else CheckStatus.NOT_FOUND
            # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–∞–∫–ª–∞–¥–Ω—É—é —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –æ—Ç—á—ë—Ç–∞
            return CheckedInvoice(invoice=invoice, status=status)
        except Exception as e:
            # –õ–æ–≥–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –Ω–∞ –æ–¥–Ω–æ–º –∏–∑ —ç—Ç–∞–ø–æ–≤
            self.logger.error(f"–û—à–∏–±–∫–∞ {e}")
            return CheckedInvoice(invoice=invoice, status=CheckStatus.ERROR)

    def start(self):
        """
        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Å–µ—Å—Å–∏—é:
        1. –ó–∞–ø—É—Å–∫–∞–µ—Ç –±—Ä–∞—É–∑–µ—Ä
        2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
        3. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ–ø–∞–ø —Ä–µ–≥–∏–æ–Ω–∞
        4. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞
        5. –ê–≤—Ç–æ—Ä–∏–∑—É–µ—Ç—Å—è –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Ä–µ–≥–∏–æ–Ω–∞
        6. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ –ø–∞–Ω–µ–ª—å –¥–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä–∞
        7. –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ —Ä–∞–∑–¥–µ–ª "–¥–æ–∫—É–º–µ–Ω—Ç—ã"
        8. –î–æ–∂–∏–¥–∞–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

        –®–∞–≥–∏:
        1. –ü–æ–ª—É—á–∏—Ç—å –ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –∏–∑ .env —Å –ø–æ–º–æ—â—å—é os.getenv()
        2. –°–æ–∑–¥–∞—Ç—å —ç–∫–∑–µ–º–ø–ª—è—Ä WebDriver (Chrome)
        3. –ú–∞–∫—Å–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–∫–Ω–æ
        4. –°–æ–∑–¥–∞—Ç—å Page Objects:
           - MainPage
           - LoginPage
           - SubsystemsPage
           - DistributorPanelPage
           - InvoicesPage
        5. –í—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–æ–≤:
           - main_page.open() ‚Üí accept_region_popup() ‚Üí go_to_login_page()
           - login_page.login(username, password)
           - subsystems_page.go_to_distributor_panel()
           - distributor_panel.go_to_section("documents")
        6. –î–æ–∂–¥–∞—Ç—å—Å—è, —á—Ç–æ invoices_page.is_loaded() –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞
        7. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–ª–∞–≥ _initialized = True

        –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
        - –ü–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º —à–∞–≥–æ–º ‚Äî –∑–∞–ø–∏—Å–∞—Ç—å –≤ logger.log()
        - –ü—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî logger.error(), –∑–∞—Ç–µ–º _safe_quit()

        Raises:
            RuntimeError: –ï—Å–ª–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ —É–¥–∞–ª–∞—Å—å
        """
        if self._initialized:
            return
        try:
            username_key, password_key = self.CREDENTIALS[self.region]
            username = self.config.get_secret(username_key)
            password = self.config.get_secret(password_key)
            if not password:
                raise RuntimeError(f"–î–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–¥–∞–Ω—ã –õ–æ–≥–∏–Ω: {username}, –ü–∞—Ä–æ–ª—å: {password}")
            self.logger.info(f"–ó–∞–ø—É—Å–∫ DMS –¥–ª—è —Ä–µ–≥–∏–æ–Ω–∞ {self.region}")
            # --- –ù–ê–ß–ê–õ–û: –°–æ–∑–¥–∞–Ω–∏–µ –¥—Ä–∞–π–≤–µ—Ä–∞ —Å –æ–ø—Ü–∏—è–º–∏ ---
            options = webdriver.ChromeOptions()
            options.add_argument("--start-maximized")
            options.add_argument("--disable-gpu")
            options.add_argument("--no-sandbox")  # üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û
            options.add_argument("--disable-dev-shm-usage")  # üî¥ –î–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –≤ Windows
            options.add_argument("--disable-extensions")
            options.add_argument("--disable-popup-blocking")
            options.add_argument("--disable-blink-features=AutomationControlled")

            self.driver = webdriver.Chrome(options=options)
            self.driver.maximize_window()

            # –¢–≤–æ–π —Å—Ç–∏–ª—å, –Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π: —Å–ø–∏—Å–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º
            steps = [
                ("–û—Ç–∫—Ä—ã—Ç–∏–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã", MainPage, lambda p: p.open()),
                ("–ü—Ä–∏–Ω—è—Ç–∏–µ —Ä–µ–≥–∏–æ–Ω–∞", MainPage, lambda p: p.accept_region_popup()),
                ("–ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞", MainPage, lambda p: p.go_to_login_page()),

                ("–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è", LoginPage, lambda p: p.login(username, password)),

                ("–ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø–∞–Ω–µ–ª—å –¥–∏—Å—Ç—Ä–∏–±—å—é—Ç–æ—Ä–∞", SubsystemsPage, lambda p: p.go_to_distributor_panel()),

                ("–ü–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–∞–∑–¥–µ–ª '–î–æ–∫—É–º–µ–Ω—Ç—ã'", DistributorPanelPage, lambda p: p.go_to_section("documents")),
            ]

            for description, PageClass, action in steps:
                self.logger.info(f"‚û°Ô∏è {description}")
                try:
                    page = PageClass(self.driver)
                    action(page)
                except Exception as e:
                    self.logger.error(f"‚ùå –û—à–∏–±–∫–∞ –Ω–∞ —à–∞–≥–µ '{description}': {e}")
                    raise

            # –û—Ç–¥–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            self.invoices_page = InvoicesPage(self.driver)
            if self.invoices_page.is_loaded():
                self._initialized = True
                self.logger.info("–°–µ—Å—Å–∏—è DMS —É—Å–ø–µ—à–Ω–æ –∑–∞–ø—É—â–µ–Ω–∞")
                return
            raise TimeoutError("–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–±–ª–∏—Ü—ã —Å –Ω–∞–∫–ª–∞–¥–Ω—ã–º–∏ –¥–æ–ª–≥–∞—è")

        except TimeoutError as e:
            self.logger.error("–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–±–ª–∏—Ü—ã —Å –Ω–∞–∫–ª–∞–¥–Ω—ã–º–∏ –¥–æ–ª–≥–∞—è, –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞")
            self.start()
        except Exception as e:
            self._safe_quit()
            raise RuntimeError(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ DMS ({e})")

    def close(self):
        """
        –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –±—Ä–∞—É–∑–µ—Ä –∏ –æ—á–∏—â–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã.

        –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—Å–µ—Ö –Ω–∞–∫–ª–∞–¥–Ω—ã—Ö —Ä–µ–≥–∏–æ–Ω–∞.
        –ü–µ—Ä–µ–¥–∞—ë—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ _safe_quit().
        """
        self._safe_quit()


    def _switch_to_city(self, city: str):
        """
        –ü–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç —Ç–µ–∫—É—â—É—é –ø–ª–æ—â–∞–¥–∫—É –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—É—é.

        Args:
            city (str): –ì–æ—Ä–æ–¥ ("–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫", "–ß–µ–ª—è–±–∏–Ω—Å–∫" –∏ —Ç.–¥.)

        –®–∞–≥–∏:
        1. –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —á–µ—Ä–µ–∑ invoices_page.get_current_orgstructure()
        2. –ï—Å–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –æ–∂–∏–¥–∞–µ–º–æ–π ‚Äî –≤—ã–∑–≤–∞—Ç—å invoices_page.select_orgstructure_by_city(city)
        3. –î–æ–∂–¥–∞—Ç—å—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ –æ–∂–∏–¥–∞–Ω–∏–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è –ª–æ–∞–¥–µ—Ä–∞)

        –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
        - –ó–∞–ø–∏—Å–∞—Ç—å: "–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ø–ª–æ—â–∞–¥–∫—É: {city}"

        –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:
        - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç InvoicesPage.select_orgstructure_by_city()
        """
        expected = f"–û–û–û ¬´–ö–æ–Ω—Ç–∏–Ω–µ–Ω—Ç¬ª ({city})"
        try:
            current = self.invoices_page.get_current_orgstructure()
            if current == expected:
                return

            self.logger.info(f"üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –ø–ª–æ—â–∞–¥–∫—É: {city}")
            self.invoices_page.select_orgstructure_by_city(city)

            # –ñ–¥—ë–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (–º–æ–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å —á–µ—Ä–µ–∑ –æ–∂–∏–¥–∞–Ω–∏–µ –ª–æ–∞–¥–µ—Ä–∞)
            # –ü—Ä–æ—Å—Ç–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –∏–ª–∏ –æ–∂–∏–¥–∞–Ω–∏–µ —Å–º–µ–Ω—ã —Ç–µ–∫—Å—Ç–∞
            WebDriverWait(self.driver, 10).until(
                lambda d: self.invoices_page.get_current_orgstructure() == expected
            )
        except RuntimeError as e:
            self.logger.error(f"–ù–æ–≤–æ–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–µ –±—ã–ª–æ –≤—ã–±—Ä–∞–Ω–æ")

    def _recover_session(self):
        """
        –ü—ã—Ç–∞–µ—Ç—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Å—Å–∏—é:
        1. –ó–∞–∫—Ä—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–π driver (–µ—Å–ª–∏ –µ—Å—Ç—å)
        2. –í—ã–∑—ã–≤–∞–µ—Ç start() –∑–∞–Ω–æ–≤–æ

        –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –µ—Å–ª–∏ driver —É–º–µ—Ä.
        """
        self._safe_quit()
        self.start()

    def _safe_quit(self):
        """
        –ë–µ–∑–æ–ø–∞—Å–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –¥—Ä–∞–π–≤–µ—Ä, –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞.

        –®–∞–≥–∏:
        1. –ï—Å–ª–∏ driver —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Äî –≤—ã–∑–≤–∞—Ç—å driver.quit()
        2. –ü–µ—Ä–µ—Ö–≤–∞—Ç–∏—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–π–º–∞—É—Ç)
        3. –û–±–Ω—É–ª–∏—Ç—å driver, invoices_page, _initialized
        4. –ó–∞–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å: "–°–µ—Å—Å–∏—è –∑–∞–∫—Ä—ã—Ç–∞"

        –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:
        - –í—ã–∑—ã–≤–∞–µ—Ç—Å—è –∏–∑ close() –∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –≤ start()
        """
        if self.driver:
            try:
                self.driver.quit()
            except:
                pass
            self.driver = None
        self.invoices_page = None
        self._initialized = False